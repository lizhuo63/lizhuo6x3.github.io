![](https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2022-06-07_08-20-45.png)

<img src="https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/Snipaste_2022-06-07_08-25-50.png" style="zoom:67%;" />

# 程序计数器

是当前线程所执⾏的字节码的⾏号指示器，分⽀、循环、跳转、异常处理、线程恢复等功能都需要依赖这个计数器来完成。**程序计数器是唯⼀⼀个不会出现 OutOfMemoryError 的内存区域**

#  Java 虚拟机栈

局部变量表主要存放了编译期可知的各种数据类型、对象引⽤。调用方法时，虚拟机将局部变量表的数值传给参数变量表，实现实参向形参的传值。若执行的是实例方法，那局部变量表中0索引变量槽将被this指针占用。

**Java 虚拟机栈会出现两种错误： StackOverFlowError 和 OutOfMemoryError 。**

# 本地⽅法栈

 java虚拟机栈为虚拟机执⾏ Java ⽅法 （也就是字节码）服务，⽽本地⽅法栈则为虚拟机使⽤到的 Native ⽅法服务。此外，与 java虚拟机栈基本无二。

# 堆

堆的唯⼀⽬的就是存放对象实例，⼏乎所有的对象实例以及数组都在这⾥分配内存。Jdk1.7以后又新移入了**字符串常量池**。

## 字符串常量池

JVM为了提升性能和减少内存开销，避免字符串的重复创建，将字符串常量池交由String类私有维护，用于存放字符串的引用或者字符串。

# ⽅法区（元空间）

⽅法区与 Java 堆⼀样，是各个线程共享的内存区域，它⽤于存储已被虚拟机加载的类信息、常
量、静态变量、即时编译器编译后的代码等数据。

## 运⾏时常量池（常量池）

Class ⽂件中除了有类的版本、字段、⽅法、接⼝等描述信息外，还有常量池表（⽤于存放编译期⽣成的各种字⾯量和符号引⽤）

# 直接内存

Java进程所在的宿主机内存，也叫做堆外内存，并不**直接**由JVM直接管理和回收；借助NIO使用native函数库直接分配堆外内存，通过VM堆中的DirectByteBuffer对象对这块内存进行引用和操作，从而避免Java堆与宿主机内存的来回复制操作。

# 各种量、值的存储位置

+ 类、接口，数组、对象：===== 堆
+ 成员变量：===== 堆
+ 字面量：===== 堆（字符串常量池）
+ 静态方法、静态变量：===== 方法区
+ 方法中间值、参数，局部变量，引用：=====栈（ 局部变量表）

# 常量池

## 静态常量池（Class常量池）

*.class文件中的常量池，在编译期被确定。可以理解为是Class文件的资料库，它包含类的版本、字段、方法、接口等描述信息，也包括各种字面量和符号引用。占用class文件绝大部分空间。

## 运⾏时常量池

方法区的一部分，存放编译器生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的运行时常量池。在class文件被加载进了内存之后，**运行时常量池保存在了方法区中**，通常说的常量池指的是运行时常量池。

## 字符串常量池

堆的一部分，本质是一个HashSet<String>，这是一个纯运行时的结构，而且是惰性维护的。注意它只存储String对象的引用，而不存储String对象的内容，根据这个引用可以得到具体的String对象。

### 作用

为了避免频繁的创建和销毁对象而影响系统性能，实现了对象的共享。

1. 节省内存空间：常量池中所有相同的字符串常量被合并，只占用一个空间。
2. 节省运行时间：比较字符串时，比equals()快。对于两个引用变量，只用判断引用是否相等，也就可以判断实际值是否相等

