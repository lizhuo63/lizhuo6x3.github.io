# 数据类型

## String

键值对

## Hash

+ hash，左边一个key，对右边一个存储空间叫hash，也就是说hash是指的一个数据类型，不是一个数据，是这里边的一堆数据

+ 只能存储字符串，不允许存储其他数据类型

![image-20220616121137806](https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/image-20220616121137806.png)

## List

双向链表的结构

## Set

+ 新的存储需求：存储大量的数据，在查询方面提供更高的效率
+ 需要的存储结构：能够保存大量的数据，高校的内部存储机制，便于查+ 询
+ list有顺序，链表查询数据的效率很低，增删时间复杂度为O(1)，查询时间复杂度为O(n)
+ 而hash增删查的时间复杂度都是O(1)

![image-20220616121647091](https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/image-20220616121647091.png)

## Sorted_Set

再set的存储结构基础上添加可排序字段

![image-20220616121853317](https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/image-20220616121853317.png)

# 持久化

## RDB  快照存储：存储即时状态

**有两大指令**

**save：**save指令会阻塞当前的Redis服务器直至当前RDB完成，故线上不建议使用。

**bgsave：**是正对save阻塞的一个优化，主流

![image-20220616122253078](https://lizhuo-file.oss-cn-hangzhou.aliyuncs.com/img/image-20220616122253078.png)

**缺点**

1.即时存储，无法做到实时持久化，具有较大的可能性丢失数据

2.每次读写都是全部数据，当数据量巨大时，效率非常低

3.大数据量下的IO性能较低

4.基于fork创建子进程，内存产生额外消耗

5.宕机带来的数据丢失风险

## AOF   日志：存储操作过程

​	所有操作均进行记录，排除丢失数据的风险降低区分数据是否改变的难度，改记录数据为记录操作过程。有以下三种策略：

+ **always**(每次）：每次写入操作均同步到AOF文件中数据零误差，性能较低，不建议使用。

+ **everysec**（每秒）：每秒将缓冲区中的指令同步到AOF文件中，在系统突然宕机的情况下丢失1秒内的数据 数据准确性较高，性能较高，建议使用，也是默认配置

+ **no**（系统控制）：由操作系统控制每次同步到AOF文件的周期，整体过程不可控【不推荐】

## 重写功能

概率：对影响同一个数据的若干指令进行优化记录；

- 降低磁盘占用量，提高磁盘利用率
- 提高持久化效率，降低持久化写时间，提高IO性能
- 降低数据恢复用时，提高数据恢复效率

# 过期数据

TTL返回的值有三种情况：正数，-1，-2，由一个hash结构来维护

- **正数**：代表该数据在内存中还能存活的时间
- **-1**：永久有效的数据
- **2** ：已经过期的数据 或被删除的数据 或 未定义的数据

## 过期删除策略

### 定时删除

+ 当key设置有过期时间，且过期时间到达时，由定时器任务立即执行对键的删除操作【到点就删】

+ 用处理器性能换取存储空间（拿时间换空间）

### 惰性删除

+ 数据到达过期时间，不做处理。等下次访问该数据时，我们需要判断
  1. 如果未过期，返回数据
  2. 发现已过期，删除，返回不存在

+ 用存储空间换取处理器性能（拿时间换空间）

### 定期删除

周期性抽查存储空间（随机抽查，重点抽查）

# 企业解决方案

redis雪崩是指redis在某个时间大量失效，突然造成数据库访问压力急剧增大，像雪崩一样，redis雪崩危害巨大，甚至有可能服务器宕机，给公司造成巨大的经济损失。

解决方案：设置超时时间的时候要设置随机值，不要设置固定值

##  缓存穿透

缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求。

方案：设置拦截器，对于不存在得key,进行拦截

## 缓存击穿

缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期）

解决方案：设置热点数据永不过期

