# Spring Cloud

### 什么是 Spring Cloud？



### 熔断机制介绍



### 什么是分布式事务

当用户访问量形成级别时，DB的访问压力会非常大，此时往往会在给DB搭建集群之外引入redis缓存集群【分布式缓存】，并将热点数据拉到redis中。但是当某个操作需要扫描多个表的数据时，往往就会**涉及到多个数据库的操作**，而为了保证数据的一致性，就出现了**分布式事务**。

### 分布式事务控制CAP理论

分布式系统在设计时只能在一致性(Consistency)、可用性(Availability)、分区容忍性(PartitionTolerance)中满足两种，无法兼顾三种。

### 分布式事务的实现方式

+ **两阶段提交协议(2PC)：**

  1. 事务协调器向操作涉及到的所有数据库均发起预提交指令 prepare
  2. 事务协调器统计所有数据库的反馈结果
     1. 但凡存在一个no，就回滚
     2. 若全为yes，事务协调器会向涉及到的所有数据库发起预提交指令 commit

+ **事务补偿 TCC：**

  1. Try 对业务系统做提交事务前的检测及资源预留，如果执行成功，就执行2，否则3
  2. Confirm 对业务系统做确认提交
  3. Cancel  "回滚"，执行的业务取消，预留资源释放

  

### 分布式事务解决方案



### 分布式锁的实现方式

分布式锁是控制分布式系统之间同步访问共享资源的一种方式。不同系统或者是同一系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，需要通过一定的互斥手段来防止彼此的干扰，以保证一致性。

**Redis实现分布式锁：**

+  WATCH, MULTI, EXEC, DISCARD**事务机制**实现分布式锁：

  被MULTI和EXEC包裹的redis命令，保证所有事务内的命令将会串行顺序执行，保证不会在事务的执行过程中被其他客户端打断；而WATCH命令能够监视某个键，当事务执行时，如果被监视的键被其他客户端修改了值，事务运行失败，返回相应错误。

  ```bash
  MULTI
  some redis command
  EXEC
  ```

+ **SETNX**实现:

  当指定键不存在时，向Redis中添加一个键值对。Redis客户端保证对统一键名称，多个客户端同时设置其值时，只有一个客户端能够设置成功的原子性。



### 分布式session的实现方式【解决方案】

分布式session，为了让多个服务器共享同一个session。保证用户状态的一致性。

+ **客户端存储：**直接将信息存储在cookie中
+  **session绑定：** 使用Nginx为用户端和服务端建立绑定，同一个客户端就只能访问该服务器。
+ **基于redis存储session：**

### Dubbo支持几种负载均衡策略

随机、轮询、最小活跃数、一致性哈希。

### Dubbo启动的时候支持几种配置方式

XML、dubbo.properties、java、@Service注解暴露服务。

### Dubbo 超时时间怎样设置

消费者和提供者均可设置，但是消费端的优先级更高。

### dubbo和Feign的差异

**feign**：基于成熟Http协议。求和响应格式臃肿，其通信效率相对会差一些。

**Dubbo：**默认采用Dubbo自定义通信协议【属于TCP】。但是Dubbo协议自定义了Java数据序列化和反序列化方式、数据传输格式，因此在数据传输性能上会比Http协议要好一些。